<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GGNO-IOT</title>

<link rel="manifest" href="manifest.json">

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:linear-gradient(135deg,#ff2d55,#ff9500,#34c759,#007aff);
  background-size:400% 400%;
  animation:bg 12s ease infinite;
  color:white;
  text-align:center;
}

@keyframes bg{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

h1{
  margin-top:20px;
  font-size:28px;
}

.card{
  background:rgba(0,0,0,0.6);
  margin:15px auto;
  padding:15px;
  border-radius:15px;
  width:90%;
  max-width:400px;
  box-shadow:0 0 20px rgba(0,0,0,0.4);
}

.value{
  font-size:26px;
  font-weight:bold;
}

button{
  margin:8px;
  padding:10px 20px;
  border:none;
  border-radius:20px;
  font-size:16px;
  cursor:pointer;
}

.green{background:#34c759;color:white;}
.red{background:#ff3b30;color:white;}
.blue{background:#007aff;color:white;}
.pink{background:#ff2d55;color:white;}
</style>
</head>

<body>

<h1>ğŸš€ GGNO-IOT</h1>

<div class="card">
  ğŸŒ¡ Temperatura
  <div class="value" id="temp">--</div>
</div>

<div class="card">
  ğŸ¯ Target
  <div class="value" id="target">--</div>
</div>

<div class="card">
  ğŸ”¥ Caldaia
  <div class="value" id="caldaia">--</div>
  <button class="green" onclick="sendCmd('on')">ON</button>
  <button class="red" onclick="sendCmd('off')">OFF</button>
  <button class="blue" onclick="sendCmd('auto')">AUTO</button>
</div>

<div class="card">
  ğŸ“¡ WiFi
  <div class="value" id="wifi">--</div>
</div>

<div class="card">
  ğŸ“ GSM
  <div class="value" id="gsm">--</div>
</div>

<div class="card">
  ğŸ‘¤ Ultimo Accesso
  <div class="value" id="accesso">--</div>
</div>

<script>

const SUPABASE_URL = "https://fdjntsvpcfcajqyerqvn.supabase.co";
const SUPABASE_KEY = "sb_publishable_m2yiJiIzIuDH_I4yLgyjhw_bRMZDTTo";

async function loadData(){
  const res = await fetch(
    SUPABASE_URL + "/rest/v1/device_status?select=*&order=created_at.desc&limit=1",
    {
      headers:{
        "apikey":SUPABASE_KEY,
        "Authorization":"Bearer " + SUPABASE_KEY
      }
    }
  );

  const data = await res.json();
  if(!data.length) return;

  const d = data[0];

  document.getElementById("temp").innerText = d.temp + " Â°C";
  document.getElementById("target").innerText = d.target + " Â°C";
  document.getElementById("caldaia").innerText = d.caldaia_on ? "ON ğŸ”¥" : "OFF â„ï¸";
  document.getElementById("wifi").innerText = d.wifi_rssi + " dBm";
  document.getElementById("gsm").innerText = d.gsm_csq + " /31";
  document.getElementById("accesso").innerText = d.ultimo_accesso;
}

setInterval(loadData,5000);
loadData();

</script>

</body>
</html>
